const { MigrationInterface, QueryRunner } = require("typeorm");

module.exports = class chatMemberIdAutogenerated1676980344626 {
    name = 'chatMemberIdAutogenerated1676980344626'

    async up(queryRunner) {
        await queryRunner.query(`ALTER TABLE "chat_member" ADD "id" uuid NOT NULL DEFAULT uuid_generate_v4()`);
        await queryRunner.query(`ALTER TABLE "chat_member" DROP CONSTRAINT "PK_19ebaef9771578d9922a3291b82"`);
        await queryRunner.query(`ALTER TABLE "chat_member" ADD CONSTRAINT "PK_8a289566abf08362305eab1a0fa" PRIMARY KEY ("userId", "chatId", "id")`);
        await queryRunner.query(`ALTER TABLE "chat_member" DROP CONSTRAINT "FK_92e48cf204fcce7febc738c8d6f"`);
        await queryRunner.query(`ALTER TABLE "chat_member" DROP CONSTRAINT "FK_0b7f67b9d8726c419922462e848"`);
        await queryRunner.query(`ALTER TABLE "chat_member" DROP CONSTRAINT "PK_8a289566abf08362305eab1a0fa"`);
        await queryRunner.query(`ALTER TABLE "chat_member" ADD CONSTRAINT "PK_06531cd5c8a81440eebe9c53110" PRIMARY KEY ("userId", "id")`);
        await queryRunner.query(`ALTER TABLE "chat_member" DROP CONSTRAINT "PK_06531cd5c8a81440eebe9c53110"`);
        await queryRunner.query(`ALTER TABLE "chat_member" ADD CONSTRAINT "PK_2aad8c13481bba9b43eaa2a774f" PRIMARY KEY ("id")`);
        await queryRunner.query(`ALTER TABLE "chat_member" ADD CONSTRAINT "FK_92e48cf204fcce7febc738c8d6f" FOREIGN KEY ("chatId") REFERENCES "chat"("id") ON DELETE CASCADE ON UPDATE NO ACTION`);
        await queryRunner.query(`ALTER TABLE "chat_member" ADD CONSTRAINT "FK_0b7f67b9d8726c419922462e848" FOREIGN KEY ("userId") REFERENCES "user"("id") ON DELETE NO ACTION ON UPDATE NO ACTION`);
    }

    async down(queryRunner) {
        await queryRunner.query(`ALTER TABLE "chat_member" DROP CONSTRAINT "FK_0b7f67b9d8726c419922462e848"`);
        await queryRunner.query(`ALTER TABLE "chat_member" DROP CONSTRAINT "FK_92e48cf204fcce7febc738c8d6f"`);
        await queryRunner.query(`ALTER TABLE "chat_member" DROP CONSTRAINT "PK_2aad8c13481bba9b43eaa2a774f"`);
        await queryRunner.query(`ALTER TABLE "chat_member" ADD CONSTRAINT "PK_06531cd5c8a81440eebe9c53110" PRIMARY KEY ("userId", "id")`);
        await queryRunner.query(`ALTER TABLE "chat_member" DROP CONSTRAINT "PK_06531cd5c8a81440eebe9c53110"`);
        await queryRunner.query(`ALTER TABLE "chat_member" ADD CONSTRAINT "PK_8a289566abf08362305eab1a0fa" PRIMARY KEY ("userId", "chatId", "id")`);
        await queryRunner.query(`ALTER TABLE "chat_member" ADD CONSTRAINT "FK_0b7f67b9d8726c419922462e848" FOREIGN KEY ("userId") REFERENCES "user"("id") ON DELETE NO ACTION ON UPDATE NO ACTION`);
        await queryRunner.query(`ALTER TABLE "chat_member" ADD CONSTRAINT "FK_92e48cf204fcce7febc738c8d6f" FOREIGN KEY ("chatId") REFERENCES "chat"("id") ON DELETE CASCADE ON UPDATE NO ACTION`);
        await queryRunner.query(`ALTER TABLE "chat_member" DROP CONSTRAINT "PK_8a289566abf08362305eab1a0fa"`);
        await queryRunner.query(`ALTER TABLE "chat_member" ADD CONSTRAINT "PK_19ebaef9771578d9922a3291b82" PRIMARY KEY ("userId", "chatId")`);
        await queryRunner.query(`ALTER TABLE "chat_member" DROP COLUMN "id"`);
    }
}
